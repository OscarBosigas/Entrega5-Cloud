{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/oscar/OneDrive/Desktop/maestria/semestre2/Cloud/Entrega4/Entrega4-Cloud/Front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ChangeDetectorRef } from '@angular/core';\nimport { switchMap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/tasks.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\n\nfunction CrudComponent_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"dd\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"td\")(5, \"dd\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"td\")(8, \"dd\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"td\")(11, \"dd\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"td\")(14, \"dd\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"td\")(17, \"dd\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"td\")(20, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function CrudComponent_tr_16_Template_button_click_20_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const e_r1 = restoredCtx.$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onBorrar(e_r1.id));\n    });\n    i0.ɵɵtext(21, \"Borrar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"td\")(23, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function CrudComponent_tr_16_Template_button_click_23_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const e_r1 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.onDescargar(e_r1.fileName, e_r1.format, e_r1.status));\n    });\n    i0.ɵɵtext(24, \"Descargar archivo\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const e_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.id);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.email);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.status);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.time);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.fileName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(e_r1.format);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.isUploaded);\n  }\n}\n\nexport let CrudComponent = /*#__PURE__*/(() => {\n  class CrudComponent {\n    constructor(service, router, route, changeDetectorRef) {\n      this.service = service;\n      this.router = router;\n      this.route = route;\n      this.changeDetectorRef = changeDetectorRef;\n      this.tasks = [];\n      this.isUploaded = false;\n    }\n\n    ngOnInit() {\n      this.getTasksByUser();\n    }\n\n    getTaskById() {\n      const id = this.route.snapshot.params['id'];\n      const usuarioJson = localStorage.getItem('usuario');\n\n      if (usuarioJson !== null) {\n        const usuario = JSON.parse(usuarioJson);\n        this.service.getTaskById(id, usuario).subscribe(data => {\n          this.task = data;\n        });\n      }\n    }\n\n    getTasksByUser() {\n      const usuarioJson = localStorage.getItem('usuario');\n\n      if (usuarioJson !== null) {\n        const usuario = JSON.parse(usuarioJson);\n        this.service.getTasksByUser(usuario).subscribe(data => {\n          this.tasks = data;\n        });\n      }\n    }\n\n    onBorrar(id) {\n      var _this = this;\n\n      const usuarioJson = localStorage.getItem('usuario');\n\n      if (usuarioJson !== null) {\n        const usuario = JSON.parse(usuarioJson);\n        this.service.deleteTask(id, usuario).pipe(switchMap( /*#__PURE__*/_asyncToGenerator(function* () {\n          return _this.getTasksByUser();\n        }))).subscribe(res => {\n          this.changeDetectorRef.detectChanges();\n          alert('Tarea eliminada');\n        });\n      }\n    }\n\n    onAgregar() {\n      this.router.navigate(['archivo']);\n    }\n\n    onDescargar(nombre, formato, status) {\n      const file = nombre + \".\" + formato;\n\n      if (status != \"uploaded\") {\n        this.isUploaded = true;\n        this.service.downloadFile(file);\n      }\n    }\n\n  }\n\n  CrudComponent.ɵfac = function CrudComponent_Factory(t) {\n    return new (t || CrudComponent)(i0.ɵɵdirectiveInject(i1.TasksService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n\n  CrudComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CrudComponent,\n    selectors: [[\"app-crud\"]],\n    decls: 19,\n    vars: 1,\n    consts: [[1, \"table\"], [1, \"h4\"], [4, \"ngFor\", \"ngForOf\"], [1, \"btn-success\", 3, \"click\"], [1, \"btn-danger\", 3, \"click\"], [3, \"disabled\", \"click\"]],\n    template: function CrudComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"table\", 0)(1, \"thead\")(2, \"tr\")(3, \"th\", 1);\n        i0.ɵɵtext(4, \"Id\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"th\", 1);\n        i0.ɵɵtext(6, \"Email\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"th\", 1);\n        i0.ɵɵtext(8, \"Status\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"th\", 1);\n        i0.ɵɵtext(10, \"Fecha\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"th\", 1);\n        i0.ɵɵtext(12, \"Nombre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"th\", 1);\n        i0.ɵɵtext(14, \"Formato\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(15, \"tbody\");\n        i0.ɵɵtemplate(16, CrudComponent_tr_16_Template, 25, 7, \"tr\", 2);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function CrudComponent_Template_button_click_17_listener() {\n          return ctx.onAgregar();\n        });\n        i0.ɵɵtext(18, \"Agregar Archivo\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"ngForOf\", ctx.tasks);\n      }\n    },\n    dependencies: [i3.NgForOf]\n  });\n  return CrudComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}